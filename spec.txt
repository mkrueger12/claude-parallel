# Claude Parallel - Installer CLI for Parallel AI Implementation Workflows

## Project Overview
An npm-installable CLI tool that installs standalone GitHub Actions workflows for parallel Claude Code implementations into any repository. Once installed with `npx install-claude-parallel`, the workflows run parallel implementations, automatically review them, and create draft PRs with the best implementation. The system also supports multi-provider AI plan generation using Anthropic Claude, OpenAI GPT, and Google Gemini to create comprehensive implementation plans with Linear issue tracking.

## Technology Stack

### Core Infrastructure
- **Distribution**: npm package (`install-claude-parallel`) with CLI installer
- **CI/CD**: GitHub Actions with standalone workflows (no external references)
- **Scripting**: Bash shell scripts, TypeScript with Bun runtime
- **Bundling**: Bun bundler for self-contained JavaScript files
- **Version Control**: Git with worktree support
- **AI Integration**:
  - OpenCode SDK (`@opencode-ai/sdk`) for all agent operations (unified SDK)
  - Anthropic API, OpenAI API, Google Gemini API
  - No external CLI dependencies (embedded server architecture)
- **Issue Tracking**: Linear SDK (`@linear/sdk`)
- **Conversation Logging**: Turso (libSQL) for optional session storage
- **Package Manager**: Bun (primary), npm, pnpm, yarn support
- **TypeScript**: Strict mode with ES2022 target, NodeNext modules

### Multi-Language Support
- **JavaScript/TypeScript**: Node.js, Bun, npm, pnpm, yarn
- **Python**: pip, poetry, pytest
- **Go**: go modules, go build, go test
- **Rust**: cargo build, cargo test
- **Java**: Maven, Gradle
- **Ruby**: bundler, gem
- **PHP**: composer

### GitHub Actions Architecture
- Standalone workflows installed into user repositories
- Self-contained scripts (bundled JavaScript) for all operations
- Matrix strategy for parallel execution
- Artifact management for result sharing
- No external repository references or dependencies

## Prerequisites

### For Installing the Workflows
- Node.js >= 20.0.0 (for running `npx install-claude-parallel`)
- Git repository (recommended but not required)

### For Using the Installed Workflows
- GitHub repository with Actions enabled
- GitHub Personal Access Token (GH_PAT) with repo permissions
- At least one AI provider authentication:
  - CLAUDE_CODE_OAUTH_TOKEN (preferred for all workflows, required for multi-provider planning)
  - ANTHROPIC_API_KEY (alternative for implementation workflow, fallback option)
  - OPENAI_API_KEY (optional, for multi-provider planning)
  - GOOGLE_GENERATIVE_AI_API_KEY (optional, for multi-provider planning)
- Linear API credentials (optional, for issue tracking):
  - LINEAR_API_KEY
  - LINEAR_TEAM_ID
  - LINEAR_PROJECT_ID (optional)

### For Development
- Node.js >= 20.0.0 or Bun >= 1.0.0
- TypeScript knowledge for modifying agents
- Git and gh CLI

## Core Features

### Installer CLI
- **Distribution Method**: npm package installable with `npx install-claude-parallel`
- **Installation Features**:
  - Copies standalone workflows to `.github/workflows/`
  - Installs bundled scripts to `.github/claude-parallel/scripts/`
  - Installs prompt templates to `.github/claude-parallel/prompts/`
  - Installs Claude Code agents to `.claude/agents/`
  - Creates `.env.example` with documented secrets
- **Update Management**:
  - Manifest-based file tracking with SHA-256 hashes
  - Detects user modifications and preserves them
  - Safe re-runs update only unchanged files
  - `--force` flag for complete overwrite
- **CLI Flags**:
  - `--help`: Show usage information
  - `--yes`: Skip confirmation prompts
  - `--dry-run`: Preview changes without applying
  - `--force`: Overwrite all files including user modifications
- **Installed Files** (17 total):
  - 2 workflows (claude-plan.yml, claude-implement.yml)
  - 4 bundled scripts (planning-agent.js, linear-agent.js, opencode-agent-runner.js, detect-runtime.sh)
  - 5 prompt templates
  - 4 agent definitions
  - 1 .env.example
  - 1 .install-manifest.json

### Parallel Implementation Workflow
- **Trigger Methods**:
  - GitHub issue label (`claude-implement`)
  - Manual workflow dispatch with issue number
- **Matrix-Based Parallel Execution**:
  - Configurable number of implementations (default: 3)
  - Independent execution in separate branches
  - Concurrent runtime for maximum efficiency
- **Automated Branch Management**:
  - Branch naming: `impl-{run_id}-{impl_number}`
  - Automatic cleanup of non-winning branches
  - Winning branch preserved for PR
- **Smart Runtime Detection**:
  - Auto-detects project language and package manager
  - Sets up appropriate environment (Node.js, Python, Go, Rust, etc.)
  - Installs dependencies automatically
  - Supports custom runtime configurations

### AI-Powered Implementation
- **Claude Code Integration**:
  - Headless CLI execution
  - JSON output format for parsing
  - Configurable model selection (Opus, Sonnet, Haiku)
  - Custom prompt templates with variable substitution
  - Structured output with JSON schema validation
- **Custom Agent System**:
  - Installed in `.claude/agents/` directory
  - Specialized agents for different tasks
  - Agent delegation for planning and implementation
  - Research agents (codebase-locator, codebase-analyzer)
  - Implementation agents (coding-agent)
  - Debug agent (debug-agent)
- **Prompt Template System**:
  - Markdown-based prompt templates installed in `.github/claude-parallel/prompts/`
  - Variable substitution (FEATURE_REQUEST, NUM_IMPLEMENTATIONS, etc.)
  - Templates are standalone files (no external fetching)
  - Customizable by users after installation

### Automated Code Review
- **Multi-Implementation Comparison**:
  - Reviews all implementations via git diff
  - Evaluates code quality, completeness, maintainability
  - Structured decision output with JSON schema
  - Detailed reasoning for selection
- **Review Criteria**:
  - Code quality and style consistency
  - Feature completeness
  - Error handling
  - Test coverage
  - Documentation
  - Performance considerations
- **Robust Parsing**:
  - Multiple parsing strategies for Claude output
  - Handles structured_output, result field, and root-level JSON
  - Fallback regex extraction
  - Detailed error messages for debugging

### Automated Verification
- **Build Checks**:
  - Language-specific build commands
  - Compilation verification
  - Build artifact validation
  - Error output capture
- **Test Execution**:
  - Unit tests
  - Integration tests
  - Test coverage reporting
  - Failure diagnostics
- **Code Quality**:
  - Linting (ESLint, ruff, golint, clippy)
  - Type checking (TypeScript, mypy)
  - Code formatting validation
  - Style guide compliance
- **Automated PR Comments**:
  - Verification status table
  - Build/test/lint/typecheck results
  - Summary of issues found
  - Links to detailed logs

### Multi-Provider Plan Generation

**Architecture** (v2 - Parallel Jobs Approach):
- Three concurrent GitHub Actions jobs
- Each provider runs independently
- Plans passed via job outputs
- Better visibility in GitHub UI
- Fail-fast: stops if any provider fails
- Idiomatic GitHub Actions patterns
- Clear failure indication per provider

**Features**:
- **Parallel Plan Generation**:
  - Anthropic Claude (default: claude-opus-4-5)
  - OpenAI GPT (default: gpt-5.2-pro)
  - Google Gemini (default: gemini-2.5-flash)
  - Concurrent execution for speed
  - Independent context per provider
- **Plan Consolidation**:
  - AI-driven analysis of all plans
  - Unified implementation strategy
  - Best practices from multiple perspectives
  - Consensus-based approach selection
- **Linear Issue Creation**:
  - Parent issue with consolidated plan
  - Sub-issues for implementation tasks
  - Automatic linking and organization
  - Project assignment support
  - GitHub issue reference in Linear

### Conversation Logging
- **Storage Backend**: Turso (libSQL) for edge-compatible SQLite
- **Optional Feature**: Enabled via environment variables, zero impact when disabled
- **Data Captured**:
  - Sessions: Agent type, model, provider, start/end times, status
  - Messages: Role, content, sequence, token counts
  - Tool executions: Name, input/output, duration, errors
- **Query API**:
  - `listSessions()`: Paginated listing with filters
  - `getSession()`: Full session details
  - `searchSessions()`: Full-text search on message content
  - `getSessionStats()`: Aggregate statistics
- **Environment Variables**:
  - `TURSO_DATABASE_URL`: Database connection URL
  - `TURSO_AUTH_TOKEN`: Authentication token
- **Automatic Initialization**: Database schema created on first use
- **Fire-and-Forget**: Logging operations don't block agent execution
- **Error Handling**: Gracefully handles missing config or database errors

### Draft PR Creation
- **Automatic PR Generation**:
  - Draft status for review
  - Descriptive title from issue
  - Implementation selection reasoning
  - Links to original issue
  - Generated by workflow attribution
- **PR Metadata**:
  - Selected implementation number
  - Review reasoning
  - Verification results
  - Build status badges
  - Issue references

## GitHub Actions Workflows

### Main Workflows

#### Reusable Implement Issue (`reusable-implement-issue.yml`)
- **Inputs**:
  - `issue_number`: Issue to implement
  - `num_implementations`: Number of parallel runs (default: 3)
  - `claude_model`: AI model selection (default: claude-opus-4-5-20251101)
  - `prompts_repo`: Source for prompts (default: mkrueger12/claude-parallel)
  - `prompts_ref`: Git ref for prompts (default: main)
  - `bot_name`: Git commit author name
  - `bot_email`: Git commit author email
  - `dry_run`: Skip AI, use mocks (default: false)
  - `event_name`: Trigger event type
  - `event_issue_number`: Issue number from event
- **Secrets**:
  - `CLAUDE_CODE_OAUTH_TOKEN`: Claude Code OAuth token (preferred, alternative auth)
  - `ANTHROPIC_API_KEY`: Anthropic API key (fallback, alternative auth)
  - Note: Provide either CLAUDE_CODE_OAUTH_TOKEN or ANTHROPIC_API_KEY; both are supported
  - `GH_PAT`: GitHub token (required)
- **Jobs**:
  1. `generate-matrix`: Creates implementation matrix
  2. `implement`: Runs N parallel implementations
  3. `review`: Compares and selects best implementation
  4. `verify`: Runs build/test/lint checks and posts results

#### Multi-Provider Plan v2 (`multi-provider-plan-v2.yml`)
- **Trigger**: Label `claude-plan-v2` on issue or manual dispatch
- **Inputs**:
  - `issue_number`: Issue to plan for
  - `linear_project_id`: Linear project (optional)
  - `anthropic_model`: Claude model selection (default: claude-sonnet-4-5)
  - `openai_model`: GPT model selection (default: gpt-5.1-codex-max)
  - `google_model`: Gemini model selection (default: gemini-2.5-pro)
- **Secrets**:
  - `CLAUDE_CODE_OAUTH_TOKEN`: Claude Code OAuth token
  - `OPENAI_API_KEY`: OpenAI auth
  - `GOOGLE_GENERATIVE_AI_API_KEY`: Google auth
  - `LINEAR_API_KEY`: Linear auth
  - `LINEAR_TEAM_ID`: Linear team
  - `LINEAR_PROJECT_ID`: Linear project (optional)
  - `GH_PAT`: GitHub token
- **Jobs**:
  1. `get-issue`: Fetches issue details
  2. `generate-plan-anthropic`: Generates plan from Claude (parallel)
  3. `generate-plan-openai`: Generates plan from GPT (parallel)
  4. `generate-plan-google`: Generates plan from Gemini (parallel)
  5. `consolidate-and-create-linear`: Consolidates plans and creates Linear issues
- **Scripts**:
  - `src/agents/planning-agent.ts`: Individual provider plan generation
  - `src/agents/linear-agent.ts`: Plan consolidation and Linear issue creation

### Custom Actions

#### Get Issue Details (`get-issue-details`)
- Fetches issue title and body
- Handles workflow_dispatch and issues events
- Creates temporary files for content
- Returns issue metadata

#### Setup Bun for Agent Runner
- Installs Bun runtime via `oven-sh/setup-bun@v2`
- Required for running OpenCode SDK agents
- No external CLI dependencies needed

#### Fetch Agents (`fetch-agents`)
- Downloads custom agent definitions
- Supports external repositories
- Version control via Git refs
- Installs to Claude config directory

#### Detect Runtime (`detect-runtime`)
- Identifies project language
- Detects package manager
- Returns runtime configuration
- Used for environment setup

### Workflow Triggers

#### Via Label
- Add `claude-implement` label to issue → triggers parallel implementation workflow
- Add `claude-plan-v2` label to issue → triggers multi-provider planning

#### Via Manual Dispatch
- Navigate to Actions tab
- Select workflow
- Enter issue number and parameters
- Click "Run workflow"

## Prompt Templates

### Implementation Prompt (`implementation.md`)
- **Variables**:
  - `{{FEATURE_REQUEST}}`: Issue title and body
- **Structure**:
  - Orientation commands (pwd, ls, cat spec.txt)
  - Planning phase with subagent delegation
  - Research task spawning (codebase-locator, codebase-analyzer, general-purpose)
  - Plan.md creation with template structure
  - Features.json creation for E2E tests
  - Implementation phase with coding-agent delegation
  - Success criteria (automated and manual)
- **Key Guidelines**:
  - Be skeptical of vague requirements
  - Be thorough with research
  - Be practical with incremental changes
  - Track progress with TodoWrite
  - No open questions in final plan
  - Unlimited time for quality

### Review Prompt (`review.md`)
- **Variables**:
  - `{{FEATURE_REQUEST}}`: Original request
  - `{{WORKTREES_DIR}}`: Path to worktrees
  - `{{NUM_IMPLEMENTATIONS}}`: Count of implementations
- **Output Schema**:
  ```json
  {
    "type": "object",
    "properties": {
      "best": {"type": "integer", "minimum": 1},
      "reasoning": {"type": "string"}
    },
    "required": ["best", "reasoning"]
  }
  ```
- **Evaluation Criteria**:
  - Code quality and maintainability
  - Feature completeness
  - Test coverage
  - Documentation quality
  - Adherence to project conventions

### Verify Prompt (`verify.md`)
- **Variables**:
  - `{{FEATURE_REQUEST}}`: Original request
  - `{{WINNING_BRANCH}}`: Selected branch
  - `{{PR_NUMBER}}`: PR number
  - `{{BUILD_STATUS}}`: Build result
  - `{{TESTS_STATUS}}`: Test result
  - `{{LINT_STATUS}}`: Lint result
  - `{{TYPECHECK_STATUS}}`: Typecheck result
  - `{{BUILD_OUTPUT}}`: Full build logs
- **Purpose**:
  - Verify implementation meets requirements
  - Analyze build/test failures
  - Provide actionable feedback
  - Suggest fixes for issues

### Plan Generation Prompt (`plan-generation.md`)
- **Variables**:
  - `{{ISSUE_TITLE}}`: Issue title
  - `{{ISSUE_BODY}}`: Issue description
- **Output**:
  - Detailed implementation approach
  - Step-by-step task breakdown
  - Risk analysis and mitigations
  - Required dependencies
  - Architecture considerations

### Consolidate and Create Linear Prompt (`consolidate-and-create-linear.md`)
- **Variables**:
  - `{{ANTHROPIC_PLAN}}`: Plan from Claude
  - `{{OPENAI_PLAN}}`: Plan from GPT
  - `{{GOOGLE_PLAN}}`: Plan from Gemini
  - `{{LINEAR_TEAM_ID}}`: Linear team
  - `{{LINEAR_PROJECT_ID}}`: Linear project (optional)
  - `{{GITHUB_ISSUE_URL}}`: Original issue link
- **Actions**:
  - Analyze all three plans
  - Identify common themes and divergences
  - Consolidate into unified strategy
  - Create Linear parent issue with consolidated plan
  - Create Linear sub-issues for tasks
  - Link issues appropriately

## Project File Structure

```
claude-parallel/
├── .github/
│   ├── workflows/
│   │   ├── reusable-implement-issue.yml    # Legacy reusable workflow (for reference)
│   │   ├── claude-implement-issue.yml       # Caller workflow example
│   │   ├── multi-provider-plan-v2.yml       # Multi-provider planning workflow
│   │   └── claude.yml                       # Claude Code action workflow
│   └── actions/
│       └── get-issue-details/              # Fetch issue metadata
├── .claude/
│   └── agents/                             # Custom Claude Code agents
│       ├── coding-agent.md                 # Feature implementation agent
│       ├── codebase-locator.md             # File/component finder agent
│       ├── codebase-analyzer.md            # Implementation analysis agent
│       └── debug-agent.md                  # Debugging agent
├── scripts/                                # Utility scripts
│   ├── opencode-agent-runner.ts            # CLI wrapper for OpenCode SDK (implementation/review)
│   ├── build-templates.ts                  # Build script for bundling templates
│   └── test-install.sh                     # Installation test script
├── src/                                    # TypeScript source code
│   ├── agents/
│   │   ├── planning-agent.ts               # Single provider plan generation (OpenCode SDK)
│   │   ├── linear-agent.ts                 # Plan consolidation and Linear creation (OpenCode SDK)
│   │   ├── implementation-agent.ts         # Implementation agent with write/edit/bash tools
│   │   └── review-agent.ts                 # Review agent with JSON schema enforcement
│   ├── cli/                                # Installer CLI source
│   │   ├── index.ts                        # CLI entry point
│   │   ├── install.ts                      # Main install logic
│   │   └── manifest.ts                     # Manifest read/write and hashing
│   ├── lib/
│   │   ├── types.ts                        # Shared TypeScript interfaces (Provider, Part, OAuth env vars)
│   │   ├── utils.ts                        # Utility functions (extractTextFromParts, getAuthCredentials)
│   │   ├── opencode.ts                     # OpenCode SDK helpers (createOpencodeServer, setProviderAuth)
│   │   ├── agent-runner.ts                 # Shared agent runner utilities
│   │   ├── turso.ts                        # Turso database client
│   │   ├── turso-schema.ts                 # Database schema definitions
│   │   └── conversation-logger.ts          # Conversation logging utilities
│   └── index.ts                            # Public API exports
├── dist/                                   # Compiled TypeScript output
│   ├── agents/
│   ├── cli/                                # Compiled CLI code
│   ├── lib/
│   └── index.js                            # Compiled entry point
├── templates/                              # Template files for installation
│   ├── workflows/
│   │   ├── claude-plan.yml                 # Standalone planning workflow template
│   │   └── claude-implement.yml            # Standalone implementation workflow template
│   ├── scripts/
│   │   ├── planning-agent.js               # Bundled planning agent (~325KB)
│   │   ├── linear-agent.js                 # Bundled linear agent (~325KB)
│   │   ├── opencode-agent-runner.js        # Bundled agent runner (~327KB)
│   │   └── detect-runtime.sh               # Runtime detection bash script
│   ├── prompts/
│   │   ├── plan-generation.md              # Plan generation prompt
│   │   ├── consolidate-and-create-linear.md # Plan consolidation prompt
│   │   ├── implementation.md               # Implementation prompt
│   │   ├── review.md                       # Review prompt
│   │   └── verify.md                       # Verification prompt
│   ├── agents/
│   │   ├── coding-agent.md                 # Coding agent definition
│   │   ├── codebase-locator.md             # Locator agent definition
│   │   ├── codebase-analyzer.md            # Analyzer agent definition
│   │   └── debug-agent.md                  # Debug agent definition
│   └── .env.example                        # Environment variables template
├── docs/
│   └── installer.md                        # Installer documentation
├── prompts/                                # Source prompts (copied to templates/)
│   ├── implementation.md
│   ├── review.md
│   ├── verify.md
│   ├── plan-generation.md
│   └── consolidate-and-create-linear.md
├── .sessions/                              # Session tracking (if using sessions pattern)
├── package.json                            # Node.js dependencies and scripts (install-claude-parallel)
├── bun.lock                                # Bun lockfile
├── tsconfig.json                           # TypeScript configuration
├── spec.txt                                # This file - project specification
├── CLAUDE.md                               # Claude Code guidance documentation
└── README.md                               # User documentation

Additional directories created at runtime:
node_modules/                               # Installed dependencies

After installation in user repository:
user-repo/
├── .github/
│   ├── workflows/
│   │   ├── claude-plan.yml                 # Multi-provider planning workflow
│   │   └── claude-implement.yml            # Parallel implementation workflow
│   └── claude-parallel/
│       ├── scripts/                        # Bundled scripts (4 files)
│       ├── prompts/                        # Prompt templates (5 files)
│       └── .install-manifest.json          # Installation manifest with file hashes
├── .claude/
│   └── agents/                             # Claude Code agents (4 files)
└── .env.example                            # Documented environment variables
```

## Usage Patterns

### Pattern 1: Label-Triggered Implementation
1. User creates GitHub issue describing feature
2. User adds `claude-implement` label
3. Workflow triggers automatically
4. N implementations execute in parallel
5. Best implementation selected via AI review
6. Draft PR created automatically
7. Verification runs and posts results to PR
8. Developer reviews and merges PR

### Pattern 2: Manual Implementation
1. Developer navigates to Actions tab
2. Selects "Claude Implement Issue" workflow
3. Enters issue number
4. Optionally overrides defaults (num_implementations, model, etc.)
5. Clicks "Run workflow"
6. Monitors progress in Actions tab
7. Reviews draft PR when complete
8. Checks verification results
9. Merges or requests changes

### Pattern 3: Multi-Provider Planning

1. User creates issue with complex feature request
2. User adds `claude-plan-v2` label
3. Three concurrent GitHub jobs generate plans (better visibility)
4. Plans passed to consolidation job via outputs
5. Consolidation job creates Linear parent issue
6. Consolidation job creates Linear sub-issues
7. Comment posted on GitHub issue with Linear links and provider status
8. Team reviews plan in Linear
9. Assigns tasks from sub-issues
10. Optionally triggers implementation workflow

## Success Criteria

### Implementation Quality
- Selected implementation fully addresses issue requirements
- Code follows project conventions and style
- Tests pass (unit, integration, E2E)
- No regressions introduced
- Documentation updated where needed
- Build succeeds without errors
- Linting passes
- Type checking passes (if applicable)

### Workflow Reliability
- Matrix generation succeeds
- All parallel jobs complete (may include failures)
- Review completes and selects winner
- PR creation succeeds
- Branch cleanup works correctly
- Artifacts uploaded and downloadable
- Error handling graceful
- Logs provide debugging info

### User Experience
- Clear PR descriptions with reasoning
- Verification results visible in PR comments
- Failed implementations logged for debugging
- Dry-run mode works for testing
- Custom prompts easy to modify
- Documentation clear and complete
- Setup straightforward for new users

### Multi-Provider Planning
- All 3 providers generate valid plans
- Consolidation produces coherent strategy
- Linear issues created successfully
- Issue linking works correctly
- GitHub comment posted with links
- Plans are diverse and thoughtful
- Consolidated plan addresses all requirements

### Performance
- Parallel execution faster than sequential
- Review completes in reasonable time
- Cleanup happens promptly
- No hanging jobs or resource leaks
- Artifact storage within limits
- API rate limits respected

## TypeScript Development

### Building and Type Checking

The project includes TypeScript code in the `src/` directory that must be compiled to JavaScript:

```bash
# Install dependencies
bun install

# Compile TypeScript to dist/
bun run build

# Run type checking without emitting files
bun run type-check

# Run agents directly (no build needed with Bun)
bun run planning-agent "Feature description"
bun run linear-agent

# Test opencode-agent-runner (used by GitHub Actions workflows)
MODEL=claude-opus-4-5 MODE=implementation echo "Your prompt here" | bun run scripts/opencode-agent-runner.ts
```

### TypeScript Structure

- **scripts/**: Utility scripts
  - `opencode-agent-runner.ts`: CLI wrapper for OpenCode SDK (used by GitHub Actions for implementation/review)
  - `build-templates.ts`: Bundles TypeScript agents into standalone JavaScript files
- **src/agents/**: Agent implementations using OpenCode SDK
  - `planning-agent.ts`: Generates plans from a single AI provider (supports Anthropic, OpenAI, Google)
  - `linear-agent.ts`: Consolidates plans and creates Linear issues
  - `implementation-agent.ts`: Implementation agent with write/edit/bash tool permissions
  - `review-agent.ts`: Review agent with JSON schema enforcement for structured output
- **src/lib/**: Shared libraries and utilities
  - `types.ts`: TypeScript interfaces (Provider, Part, OAUTH_ENV_VARS, API_KEY_ENV_VARS)
  - `utils.ts`: Utility functions (extractTextFromParts, getAuthCredentials)
  - `opencode.ts`: OpenCode SDK helpers (createOpencodeServer, setProviderAuth, setupEventMonitoring)
  - `agent-runner.ts`: Shared agent runner utilities
  - `turso.ts`, `turso-schema.ts`, `conversation-logger.ts`: Database and logging
- **src/index.ts**: Public API exports
- **dist/**: Compiled JavaScript output (committed to repo)

### TypeScript Configuration

The `tsconfig.json` uses strict settings:
- Target: ES2022
- Module: NodeNext (ESM)
- Strict type checking enabled
- Source maps and declarations generated
- Output to `dist/` directory

## Configuration and Customization

### Changing Default Models
Edit workflow inputs or workflow_dispatch defaults:
- Anthropic: claude-opus-4-5 (current default), claude-sonnet-4-5
- OpenAI: gpt-5.2-pro (current default), gpt-4-turbo, gpt-4
- Google: gemini-2.5-flash (current default), gemini-2.5-pro

### Adjusting Implementation Count
Set `num_implementations` input:
- 1: Single implementation (fastest, no comparison)
- 2: Quick comparison (moderate cost)
- 3: Default balance (good diversity)
- 5+: Maximum diversity (higher cost)

### Custom Prompts
Fork repository and modify files in `prompts/`:
- Use placeholders: `{{VARIABLE_NAME}}`
- Test locally before deploying
- Version control via Git refs
- Reference fork in workflows

### Adding New Runtimes
Edit `.github/actions/detect-runtime/action.yml`:
- Add new file patterns
- Add setup steps in workflow
- Add build/test commands
- Test with dry-run mode

### Organization-Specific Setup
1. Fork `mkrueger12/claude-parallel`
2. Customize prompts in `prompts/`
3. Adjust review criteria in `review.md`
4. Add organization-specific agents in `.claude/agents/`
5. Update workflow references to your fork
6. Configure secrets in organization settings
7. Deploy to repositories
8. If modifying TypeScript code:
   - Run `bun install` to install dependencies
   - Run `bun run build` to compile TypeScript
   - Commit both `src/` and `dist/` changes

## Cost Considerations

### Token Usage Estimates
- Simple feature: ~30k tokens per implementation
- Complex feature: ~100k tokens per implementation
- Review: ~50k tokens
- Verification: ~20k tokens
- Total for 3 implementations: ~150k-350k tokens

### Multi-Provider Planning
- Each provider plan: ~50k tokens
- Consolidation: ~100k tokens
- Total: ~250k tokens across all providers

### Optimization Strategies
- Use Haiku model for simple tasks (lower cost)
- Reduce num_implementations for straightforward features
- Use dry-run mode for testing workflows
- Cache dependencies in Actions
- Clean up artifacts promptly
- Monitor API usage dashboards

## Troubleshooting

### Common Issues

#### "Not in a git repository"
- Run from within a git repository
- Ensure .git directory exists
- Check git config is valid

#### "Required command not found"
- Install missing dependencies (git, bun, gh, jq)
- Check PATH includes executable locations
- Verify Bun runtime installation

#### "Linear API key is invalid"
- Get new key from https://linear.app/settings/api
- Update GitHub secret LINEAR_API_KEY
- Verify team ID is correct

#### "OpenCode SDK returned an error"
- Check rate limits (wait for reset)
- Verify authentication environment variables (OAuth or API key)
- Check API status for the provider
- Review error logs in artifacts

#### "Could not find decision JSON"
- Review parsing strategies in logs
- Check Claude output format
- Verify JSON schema in prompt
- Inspect raw review-result.json

#### "Verification failed"
- Check build logs in /tmp/build-results/
- Review test failures
- Fix code and re-run verification
- Update tests if requirements changed

#### Workflow doesn't trigger on label
- Verify label name is exact: `claude-implement` or `claude-plan-v2`
- Check workflow file on default branch
- Ensure secrets configured
- Check Actions enabled in repo

#### TypeScript compilation errors
- Run `bun install` to install dependencies
- Check `tsconfig.json` configuration
- Run `bun run type-check` to see detailed errors
- Ensure Node.js version >= 20.0.0 or Bun >= 1.0.0

## Security Considerations

### Secret Management
- Use GitHub Secrets for all credentials
- Never commit API keys to repository
- Rotate secrets regularly
- Use organization secrets for shared access
- Limit secret access to necessary workflows

### Code Review
- Always review AI-generated code before merging
- Check for security vulnerabilities
- Verify input validation
- Audit dependency changes
- Review permission changes

### Branch Protection
- Require PR reviews
- Require status checks to pass
- Restrict who can merge
- Require signed commits (optional)
- Enable CODEOWNERS (optional)

### Workflow Permissions
- Use minimal required permissions
- GH_PAT should have limited scope
- Review Actions permissions regularly
- Audit workflow changes
- Monitor workflow runs

## Sessions Pattern Support

The repository includes optional support for the Sessions Directory Pattern:

- `.sessions/` directory for tracking work sessions
- Slash commands: `/start-session`, `/end-session`, `/plan`, `/document`
- Automatic context management and GitHub/Linear issue fetching
- Session archiving and merged PR detection

See CLAUDE.md for more details on using the Sessions pattern.

## Future Enhancements

### Potential Features
- Support for additional AI providers (Cohere, Mistral, etc.)
- Automated performance benchmarking
- Visual diff comparison tool
- Integration with more issue trackers (Jira, Asana)
- Code quality scoring metrics
- Automated regression testing
- Parallel review by multiple reviewers
- Cost tracking and budgeting
- Team collaboration features
- Custom agent marketplace
- SDK/NPM package for programmatic usage

### Extensibility Points
- Plugin system for custom actions
- Webhook integrations
- Custom review criteria plugins
- Language-specific templates
- Organization-specific agents
- Custom verification steps
- Report generation
- Metrics and analytics

## Credits and Inspiration

Inspired by:
- [incident.io's git worktree + Claude Code workflow](https://incident.io/blog)
- [Crystal desktop app](https://github.com/stravu/crystal)
- [Anthropic Claude Quickstarts](https://github.com/anthropics/claude-quickstarts)

Built with:
- [OpenCode SDK](https://github.com/opencode-ai/sdk) - Unified AI SDK
- [GitHub Actions](https://github.com/features/actions)
- [Linear API](https://linear.app/docs/api)

## License

MIT License - See LICENSE file for details
