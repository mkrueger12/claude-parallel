[
  {
    "category": "functional",
    "id": "task-1-libsql-dependency",
    "description": "@libsql/client is added to package.json dependencies",
    "plan_ref": "Task 1 - DEL-1333: Turso Client Library Setup",
    "steps": [
      "Read package.json",
      "Verify @libsql/client is listed in dependencies",
      "Run bun install to confirm package resolves"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-1-turso-client-exports",
    "description": "src/lib/turso.ts exports getTursoClient() and getTursoConfig()",
    "plan_ref": "Task 1 - DEL-1333: Turso Client Library Setup",
    "steps": [
      "Check that src/lib/turso.ts exists",
      "Verify getTursoConfig() function is exported",
      "Verify getTursoClient() function is exported",
      "Verify createTursoClient() function is exported"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-1-graceful-missing-config",
    "description": "Client creation handles missing environment variables gracefully (returns null)",
    "plan_ref": "Task 1 - DEL-1333: Turso Client Library Setup",
    "steps": [
      "Unset TURSO_DATABASE_URL and TURSO_AUTH_TOKEN",
      "Call getTursoConfig()",
      "Verify it returns null without throwing an error",
      "Call getTursoClient()",
      "Verify it returns null without throwing an error"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-1-env-example",
    "description": "templates/.env.example documents TURSO_DATABASE_URL and TURSO_AUTH_TOKEN",
    "plan_ref": "Task 1 - DEL-1333: Turso Client Library Setup",
    "steps": [
      "Read templates/.env.example",
      "Verify TURSO_DATABASE_URL is documented",
      "Verify TURSO_AUTH_TOKEN is documented"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-1-typecheck",
    "description": "TypeScript type checking passes for turso.ts",
    "plan_ref": "Task 1 - DEL-1333: Turso Client Library Setup",
    "steps": [
      "Run bun run type-check",
      "Verify no type errors in src/lib/turso.ts"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-2-schema-tables",
    "description": "Schema creates three tables: sessions, messages, tool_executions",
    "plan_ref": "Task 2 - DEL-1334: Database Schema and Migration",
    "steps": [
      "Read src/lib/turso-schema.ts",
      "Verify CREATE TABLE sessions statement exists",
      "Verify CREATE TABLE messages statement exists",
      "Verify CREATE TABLE tool_executions statement exists"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-2-schema-indexes",
    "description": "Schema includes appropriate indexes for query performance",
    "plan_ref": "Task 2 - DEL-1334: Database Schema and Migration",
    "steps": [
      "Read src/lib/turso-schema.ts",
      "Verify CREATE INDEX on messages(session_id) exists",
      "Verify CREATE INDEX on tool_executions(session_id) exists"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-2-idempotent-migration",
    "description": "Migration runs idempotently (can be run multiple times safely)",
    "plan_ref": "Task 2 - DEL-1334: Database Schema and Migration",
    "steps": [
      "Read src/lib/turso-schema.ts",
      "Verify all CREATE TABLE use IF NOT EXISTS",
      "Verify all CREATE INDEX use IF NOT EXISTS"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-2-schema-version",
    "description": "Schema version tracking prevents duplicate migrations",
    "plan_ref": "Task 2 - DEL-1334: Database Schema and Migration",
    "steps": [
      "Read src/lib/turso-schema.ts",
      "Verify SCHEMA_VERSION constant exists",
      "Verify schema_version table is created",
      "Read src/lib/turso.ts for initializeSchema function"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-3-logger-class",
    "description": "ConversationLogger class with methods: startSession, logMessage, logToolExecution, endSession",
    "plan_ref": "Task 3 - DEL-1335: Logging Middleware Integration",
    "steps": [
      "Read src/lib/conversation-logger.ts",
      "Verify ConversationLogger class exists",
      "Verify startSession() method exists",
      "Verify logMessage() method exists",
      "Verify logToolExecution() method exists",
      "Verify endSession() method exists"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-3-opencode-integration",
    "description": "OpenCode event monitoring logs tool executions to database",
    "plan_ref": "Task 3 - DEL-1335: Logging Middleware Integration",
    "steps": [
      "Read src/lib/opencode.ts",
      "Verify ConversationLogger is imported",
      "Verify setupEventMonitoring accepts logger parameter",
      "Verify tool execution events are logged"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-3-claude-sdk-integration",
    "description": "Claude Agent SDK streams log messages to database",
    "plan_ref": "Task 3 - DEL-1335: Logging Middleware Integration",
    "steps": [
      "Read src/lib/claude-agent-sdk.ts",
      "Verify ConversationLogger is imported or can be passed",
      "Verify messages are logged as they stream"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-3-optional-logging",
    "description": "Logging is optional (gracefully disabled when Turso config missing)",
    "plan_ref": "Task 3 - DEL-1335: Logging Middleware Integration",
    "steps": [
      "Unset TURSO_DATABASE_URL and TURSO_AUTH_TOKEN",
      "Run an agent (e.g., planning-agent)",
      "Verify agent runs successfully without logging errors"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-4-list-sessions",
    "description": "listSessions() returns paginated session list with filters",
    "plan_ref": "Task 4 - DEL-1336: Query and Retrieval API",
    "steps": [
      "Read src/lib/conversation-queries.ts",
      "Verify listSessions() function exists",
      "Verify it accepts limit parameter",
      "Verify it accepts agentType filter",
      "Verify it accepts status filter"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "id": "task-4-get-session",
    "description": "getSession() returns full session details with messages and tool executions",
    "plan_ref": "Task 4 - DEL-1336: Query and Retrieval API",
    "steps": [
      "Read src/lib/conversation-queries.ts",
      "Verify getSession() function exists",
      "Verify it returns SessionDetail type with messages array",
      "Verify it returns SessionDetail type with toolExecutions array"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "id": "task-4-search-sessions",
    "description": "searchSessions() enables full-text search across conversation content",
    "plan_ref": "Task 4 - DEL-1336: Query and Retrieval API",
    "steps": [
      "Read src/lib/conversation-queries.ts",
      "Verify searchSessions() function exists",
      "Verify it accepts a query string parameter"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "id": "task-4-exports",
    "description": "Query utilities are exported from src/index.ts",
    "plan_ref": "Task 4 - DEL-1336: Query and Retrieval API",
    "steps": [
      "Read src/index.ts",
      "Verify conversation-queries exports are re-exported"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "id": "task-5-env-docs",
    "description": ".env.example includes TURSO_DATABASE_URL and TURSO_AUTH_TOKEN with documentation",
    "plan_ref": "Task 5 - DEL-1337: Template Updates and Documentation",
    "steps": [
      "Read templates/.env.example",
      "Verify TURSO_DATABASE_URL is documented with description",
      "Verify TURSO_AUTH_TOKEN is documented with description"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-5-readme-logging-docs",
    "description": "README documents conversation logging feature",
    "plan_ref": "Task 5 - DEL-1337: Template Updates and Documentation",
    "steps": [
      "Read README.md",
      "Verify 'Conversation Logging' section exists",
      "Verify Turso setup instructions are included",
      "Verify query examples are provided"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-5-spec-update",
    "description": "spec.txt updated with logging architecture",
    "plan_ref": "Task 5 - DEL-1337: Template Updates and Documentation",
    "steps": [
      "Read spec.txt",
      "Verify conversation logging section exists",
      "Verify Turso integration is documented"
    ],
    "passes": true
  },
  {
    "category": "integration",
    "id": "e2e-logging-flow",
    "description": "End-to-end: Agent conversation is logged to Turso database",
    "plan_ref": "DEL-1332: Parent issue verification",
    "steps": [
      "Set TURSO_DATABASE_URL and TURSO_AUTH_TOKEN environment variables",
      "Run planning-agent with a test prompt",
      "Query the Turso database for sessions",
      "Verify session was created with correct agent_type",
      "Query messages table for the session",
      "Verify messages were logged"
    ],
    "passes": false
  },
  {
    "category": "integration",
    "id": "e2e-logging-disabled",
    "description": "End-to-end: Agents work correctly when logging is disabled",
    "plan_ref": "DEL-1332: Parent issue verification",
    "steps": [
      "Unset TURSO_DATABASE_URL and TURSO_AUTH_TOKEN",
      "Run planning-agent with a test prompt",
      "Verify agent completes successfully",
      "Verify no errors related to logging appear"
    ],
    "passes": false
  },
  {
    "category": "integration",
    "id": "e2e-query-api",
    "description": "End-to-end: Query API can retrieve logged sessions",
    "plan_ref": "DEL-1332: Parent issue verification",
    "steps": [
      "Log a test session using ConversationLogger",
      "Call listSessions() and verify session appears",
      "Call getSession() with session ID",
      "Verify messages and tool executions are returned"
    ],
    "passes": false
  }
]
