[
  {
    "category": "functional",
    "id": "task-1-mcp-server-exists",
    "description": "AST-Grep MCP server file exists and is valid TypeScript",
    "plan_ref": "Task 1 - Create AST-Grep MCP Server",
    "steps": [
      "Check that src/mcp/ast-grep-server.ts exists",
      "Verify the file imports from @modelcontextprotocol/sdk",
      "Verify the file exports createAstGrepMcpServer function or runs as standalone"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-1-mcp-server-tools",
    "description": "MCP server exposes ast_grep_search and ast_grep_rewrite tools",
    "plan_ref": "Task 1 - Create AST-Grep MCP Server",
    "steps": [
      "Read src/mcp/ast-grep-server.ts",
      "Verify ast_grep_search tool is defined with pattern, language, path parameters",
      "Verify ast_grep_rewrite tool is defined with pattern, rewrite, language, path parameters"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-1-mcp-server-cli-integration",
    "description": "MCP server correctly executes ast-grep CLI commands",
    "plan_ref": "Task 1 - Create AST-Grep MCP Server",
    "steps": [
      "Read src/mcp/ast-grep-server.ts",
      "Verify execFile or spawn is used to run ast-grep command",
      "Verify --json output format is used",
      "Verify language mapping is correct (js, ts, py, go, rs)"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-2-claude-sdk-integration",
    "description": "Claude Agent SDK runner includes AST-Grep MCP server configuration",
    "plan_ref": "Task 2 - Integrate with Claude Agent SDK",
    "steps": [
      "Read scripts/claude-agent-runner.ts",
      "Verify ast-grep MCP server is added to mcpServers object",
      "Verify server uses stdio transport type",
      "Verify command and args are correctly configured"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-3-opencode-sdk-interface",
    "description": "OpenCode SDK agentTools interface includes astgrep option",
    "plan_ref": "Task 3 - Integrate with OpenCode SDK",
    "steps": [
      "Read src/lib/opencode.ts",
      "Verify agentTools interface has astgrep?: boolean property",
      "Verify createOpencodeServer handles astgrep option"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-3-opencode-sdk-mcp-config",
    "description": "OpenCode SDK configures AST-Grep MCP when astgrep is enabled",
    "plan_ref": "Task 3 - Integrate with OpenCode SDK",
    "steps": [
      "Read src/lib/opencode.ts",
      "Verify mcp section includes ast-grep configuration when enabled",
      "Verify 'mcp__ast-grep__*' is added to agentTools when enabled",
      "Verify permissions are set for ast-grep tools"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-4-type-definitions",
    "description": "Type definitions for AST-Grep are added to types.ts",
    "plan_ref": "Task 4 - Update Type Definitions",
    "steps": [
      "Read src/lib/types.ts",
      "Verify AstGrepMatch interface exists",
      "Verify AstGrepRange interface exists",
      "Verify AstGrepLanguage type exists"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-4-type-exports",
    "description": "AST-Grep types are exported from package index",
    "plan_ref": "Task 4 - Update Type Definitions",
    "steps": [
      "Read src/index.ts",
      "Verify AstGrepMatch, AstGrepRange, AstGrepLanguage are exported"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "id": "task-5-agent-documentation",
    "description": "Agent documentation for AST-Grep usage is created",
    "plan_ref": "Task 5 - Create Agent Documentation",
    "steps": [
      "Check that .claude/agents/ast-grep-guide.md exists",
      "Verify documentation explains when to use AST-Grep vs grep",
      "Verify documentation includes pattern syntax with metavariables",
      "Verify documentation includes language selection guidance",
      "Verify documentation includes examples"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "id": "task-6-package-dependency",
    "description": "Package.json includes MCP SDK dependency",
    "plan_ref": "Task 6 - Add Build Script Updates",
    "steps": [
      "Read package.json",
      "Verify @modelcontextprotocol/sdk is in dependencies"
    ],
    "passes": true
  },
  {
    "category": "integration",
    "id": "typescript-compilation",
    "description": "All TypeScript files compile without errors",
    "plan_ref": "All Tasks - TypeScript Compilation",
    "steps": [
      "Run bun run type-check",
      "Verify no TypeScript compilation errors"
    ],
    "passes": true
  },
  {
    "category": "integration",
    "id": "e2e-mcp-server-startup",
    "description": "AST-Grep MCP server can be started and responds to requests",
    "plan_ref": "Task 1 - End-to-End Verification",
    "steps": [
      "Start the MCP server process",
      "Send a ListTools request",
      "Verify response includes ast_grep_search and ast_grep_rewrite tools",
      "Shutdown the server cleanly"
    ],
    "passes": false
  }
]
